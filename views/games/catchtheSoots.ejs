<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Catch The Soot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-image: url('/images/catchtheSoots/Sixthstation.jpg');
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        #container {
            width: 90vw;
            max-width: 400px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: auto;
            background-color: rgb(191, 160, 113);
            border-radius: 20px;
        }

        .cell {
            aspect-ratio: 1 / 1;
            background-image: url('/images/catchtheSoots/hole1.png');
            background-size: contain;
            background-position: center;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 15px;
            overflow: hidden;
        }

        .cell img {
            width: 70%;
            height: 70%;
        }
    </style>
</head>

<body class="vh-100 w-100">

    <%- include('../navbar') %>

    <div class="d-flex flex-column justify-content-evenly align-items-center h-75">

        <h1 class="fw-bolder text-dark">Catch The Soot</h1>

        <div id="container">
            <div class="cell" data-index="0"></div>
            <div class="cell" data-index="1"></div>
            <div class="cell" data-index="2"></div>
            <div class="cell" data-index="3"></div>
            <div class="cell" data-index="4"></div>
            <div class="cell" data-index="5"></div>
            <div class="cell" data-index="6"></div>
            <div class="cell" data-index="7"></div>
            <div class="cell" data-index="8"></div>
        </div>

        <h2 id="score" class="text-danger-emphasis">0</h2>

        <button id="restart" class="btn btn-primary fs-3 fw-bolder">RESTART</button>
    </div>

    <script>
        const cells = document.querySelectorAll(".cell");
        const scoreText = document.getElementById("score");
        const restartButton = document.getElementById("restart");

        let sootTile = null;
        let noFaceTile = null;
        let score = 0;
        let gameOver = false;

        const soot = "/images/catchtheSoots/soot1.gif";
        const noface = "/images/catchtheSoots/noface.gif";

        startGame();

        function startGame() {
            cells.forEach(cell => cell.addEventListener("click", tileClicked));
            restartButton.addEventListener("click", restartGame);

            setInterval(spawnSoot, 1000);
            setInterval(spawnNoFace, 2000);
        }

        function randomIndex() {
            return Math.floor(Math.random() * 9);
        }

        function clearTile(tile) {
            if (tile) tile.innerHTML = "";
        }

        function spawnSoot() {
            if (gameOver) return;

            clearTile(sootTile);

            let index = randomIndex();
            if (noFaceTile && noFaceTile.dataset.index == index) return;

            sootTile = cells[index];
            sootTile.innerHTML = `<img src="${soot}">`;
        }

        function spawnNoFace() {
            if (gameOver) return;

            clearTile(noFaceTile);

            let index = randomIndex();
            if (sootTile && sootTile.dataset.index == index) return;

            noFaceTile = cells[index];
            noFaceTile.innerHTML = `<img src="${noface}">`;
        }

        function tileClicked() {
            if (gameOver) return;

            if (this === sootTile) {
                score += 10;
                scoreText.innerText = score;
            }
            else if (this === noFaceTile) {
                scoreText.innerText = "Oops, No-Face caught you!";
                gameOver = true;
            }
        }

        function restartGame() {
            score = 0;
            gameOver = false;

            scoreText.innerText = score;

            clearTile(sootTile);
            clearTile(noFaceTile);

            sootTile = null;
            noFaceTile = null;
        }
    </script>

</body>
</html>
